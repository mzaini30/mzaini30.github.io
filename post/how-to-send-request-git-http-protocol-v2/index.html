<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6S3BX1W068"></script>
    

    <script async="async" crossorigin="anonymous" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2408628281705149"></script>
    <title>How to download/fetch from git using git protocol v2</title>
    <!-- SEO STARTS --><meta name="mobile-web-app-capable" content="yes">
<meta name="robots" content="follow, index">
<meta name="apple-mobile-web-app-title" content="Zen">

<meta content="Collection of tech articles" name="description">
<link rel="canonical" href="https://mzaini30.js.org/post/how-to-send-request-git-http-protocol-v2/">

<meta name="og:site_name" property="og:site_name" content="Zen">
<meta name="og:type" property="og:type" content="article">
<meta property="og:description" content="Collection of tech articles">
<meta property="og:title" content="How to download/fetch from git using git protocol v2">
<meta property="og:image" content="https://hcti.io/v1/image/89f20fc5-9a1f-4565-b02d-3ff01f7288ca">
<meta property="og:url" content="https://mzaini30.js.org/post/how-to-send-request-git-http-protocol-v2/">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="zenia2020">
<meta name="twitter:title" content="How to download/fetch from git using git protocol v2">
<meta name="twitter:description" content="Collection of tech articles">
<meta name="twitter:image" content="https://hcti.io/v1/image/89f20fc5-9a1f-4565-b02d-3ff01f7288ca">
<!-- /SEO ENDS-->
    <link rel="shortcut icon" href="/icon.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/assets/betapa-mudahnya-mencari-uang.35365872.css" /><script type="module">window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","G-6S3BX1W068");document.querySelector(".disqus-data");(function(){var e=document,t=e.createElement("script");t.src="https://zenia.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})();
</script></head>
  
    <div class="p-2 astro-Y72RTCY6">
    <div class="prose mx-auto my-5 tulisan astro-Y72RTCY6">
      <h1 class="astro-Y72RTCY6">How to download/fetch from git using git protocol v2</h1>
      <p>So to download file from git using git http protocol v2 is very simple but a little bit tricky, lets go into it.</p>
<p>First, request to <code>&lt;GIT_URL&gt;/refs/info?service=git-upload-pack</code> with header <code>Git-Protocol: version=2</code> example:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">curl -H </span><span style="color:#A5D6FF">&quot;Git-Protocol: version=2&quot;</span><span style="color:#C9D1D9"> https://github.com/Hiyurigi/zenia-blog.git/info/refs</span><span style="color:#FF7B72">?</span><span style="color:#C9D1D9">service=git-upload-pack</span></span></code></pre>
<p>The server will give you response:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#c9d1d9">001e# service=git-upload-pack</span></span>
<span class="line"><span style="color:#c9d1d9">0000000eversion 2</span></span>
<span class="line"><span style="color:#c9d1d9">0023agent=git/github-gf57b30a1e6ef</span></span>
<span class="line"><span style="color:#c9d1d9">0013ls-refs=unborn</span></span>
<span class="line"><span style="color:#c9d1d9">0027fetch=shallow wait-for-done filter</span></span>
<span class="line"><span style="color:#c9d1d9">0012server-option</span></span>
<span class="line"><span style="color:#c9d1d9">0017object-format=sha1</span></span>
<span class="line"><span style="color:#c9d1d9">0000</span></span></code></pre>
<p>Let me explain what the response means…
Every request/response line to the git protocol is called PKT-LINE you can see the documentation <a href="https://git-scm.com/docs/protocol-common">Git Protocol Common</a>.
The first 4-byte PKT-LINE is hex encoded string length example: <code>0012command=fetch</code> thats mean this line have 18 character…
“Wait? that’s 17 character long” the 18th character is <code>\n</code> the newline character is optional.
The response above is called <a href="https://git-scm.com/docs/protocol-v2#_capability_advertisement">Capability Advertisement</a>.
Simply, the server give you their capability.</p>
<p>You can type request like this:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">curl -X POST -H </span><span style="color:#A5D6FF">&quot;Git-Protocol: version=2&quot;</span><span style="color:#C9D1D9"> --data-raw </span><span style="color:#A5D6FF">$&#39;0014command=ls-refs</span><span style="color:#79C0FF">\n</span><span style="color:#A5D6FF">0000&#39;</span><span style="color:#C9D1D9"> https://github.com/Hiyurigi/zenia-blog.git/git-upload-pack</span></span></code></pre>
<p>Or without newline like this:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">curl -X POST -H </span><span style="color:#A5D6FF">&quot;Git-Protocol: version=2&quot;</span><span style="color:#C9D1D9"> --data-raw </span><span style="color:#A5D6FF">$&#39;0013command=ls-refs0000&#39;</span><span style="color:#C9D1D9"> https://github.com/Hiyurigi/zenia-blog.git/git-upload-pack</span></span></code></pre>
<p>Okay, lets go deeper…
After you get the server capability you can request using <code>POST</code> method to the <code>&lt;GIT_URL&gt;/git-upload-pack</code> to get the refs.
The command-request scheme is:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#c9d1d9">command-request = command</span></span>
<span class="line"><span style="color:#c9d1d9">    capability-list</span></span>
<span class="line"><span style="color:#c9d1d9">    delim-pkt</span></span>
<span class="line"><span style="color:#c9d1d9">    command-args</span></span>
<span class="line"><span style="color:#c9d1d9">    flush-pkt</span></span>
<span class="line"><span style="color:#c9d1d9">command = PKT-LINE(&quot;command=&quot; key LF)</span></span>
<span class="line"><span style="color:#c9d1d9">command-args = *command-specific-arg</span></span>
<span class="line"><span style="color:#c9d1d9">delim-pkt = 0001</span></span>
<span class="line"><span style="color:#c9d1d9">flush-pkt = 0000</span></span></code></pre>
<p>example:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">curl -X POST -H </span><span style="color:#A5D6FF">&quot;Git-Protocol: version=2&quot;</span><span style="color:#C9D1D9"> --data-raw </span><span style="color:#A5D6FF">&quot;0014command=ls-refs</span></span>
<span class="line"><span style="color:#A5D6FF">0015agent=git/2.38.1</span></span>
<span class="line"><span style="color:#A5D6FF">0017object-format=sha1</span></span>
<span class="line"><span style="color:#A5D6FF">00010009peel</span></span>
<span class="line"><span style="color:#A5D6FF">000csymrefs</span></span>
<span class="line"><span style="color:#A5D6FF">000bunborn</span></span>
<span class="line"><span style="color:#A5D6FF">0014ref-prefix HEAD</span></span>
<span class="line"><span style="color:#A5D6FF">001bref-prefix refs/heads/</span></span>
<span class="line"><span style="color:#A5D6FF">001aref-prefix refs/tags/</span></span>
<span class="line"><span style="color:#A5D6FF">0000&quot;</span><span style="color:#C9D1D9"> https://github.com/Hiyurigi/zenia-blog.git/git-upload-pack</span></span></code></pre>
<p><code>Note: delim-pkt SHOULD NOT followed by a newline otherwise the request will failed</code></p>
<p>The server will give you back the hex-encoded hash of the refs in your repository
Example:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#c9d1d9">005238ec7c18271bd84bca6c0f55410d4da3a088877a HEAD symref-target:refs/heads/master</span></span>
<span class="line"><span style="color:#c9d1d9">003f38ec7c18271bd84bca6c0f55410d4da3a088877a refs/heads/master</span></span>
<span class="line"><span style="color:#c9d1d9">0000</span></span></code></pre>
<p>The next step is requestting the packfile, You can do that by send request to the same url with fetch command, like this</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">curl -X POST -H </span><span style="color:#A5D6FF">&quot;Git-Protocol: version=2&quot;</span><span style="color:#C9D1D9"> --data-raw </span><span style="color:#A5D6FF">&quot;0012command=ls-refs</span></span>
<span class="line"><span style="color:#A5D6FF">0015agent=git/2.38.1</span></span>
<span class="line"><span style="color:#A5D6FF">0017object-format=sha1</span></span>
<span class="line"><span style="color:#A5D6FF">0001000ethin-pack</span></span>
<span class="line"><span style="color:#A5D6FF">0010no-progress</span></span>
<span class="line"><span style="color:#A5D6FF">000eofs-delta</span></span>
<span class="line"><span style="color:#A5D6FF">0032want 38ec7c18271bd84bca6c0f55410d4da3a088877a</span></span>
<span class="line"><span style="color:#A5D6FF">0009done</span></span>
<span class="line"><span style="color:#A5D6FF">0000&quot;</span><span style="color:#C9D1D9"> https://github.com/Hiyurigi/zenia-blog.git/git-upload-pack</span></span></code></pre>
<p>For more information about fetch command you can read the documentation <a href="https://git-scm.com/docs/protocol-v2#_fetch">Git Protocol V2 Fetch</a>
The server will response you with <a href="https://git-scm.com/docs/pack-format">packfile</a> binary data, the next step is unpacking the packfile, i will do that in the next part…</p>
<p>Thanks for reading</p>
<p><em>Author: <a href="https://dev.to/hiyurigi">Hiyurigi</a></em></p>
<p><a href="https://dev.to/hiyurigi/how-to-download-file-using-git-http-protocol-v2-5dao">Dev.to version</a></p>
    </div>
    <div class="grid grid-cols-4 mx-auto max-w-[65ch] <md:grid-cols-2 gap-2 astro-Y72RTCY6">
      <a href="/post/how-to-send-request-git-http-protocol-v2" class="rounded-lg shadow border overflow-none astro-Y72RTCY6">
            <img src="https://hcti.io/v1/image/89f20fc5-9a1f-4565-b02d-3ff01f7288ca" alt="" class="w-full astro-Y72RTCY6">
            <div class="p-2 text-sm astro-Y72RTCY6">How to download/fetch from git using git protocol v2</div>
          </a><a href="/post/privacy-policy-chrome-extension" class="rounded-lg shadow border overflow-none astro-Y72RTCY6">
            <img src="https://user-images.githubusercontent.com/7939342/201555644-cfec05bc-0abe-4737-b0a5-12992e19826d.png" alt="" class="w-full astro-Y72RTCY6">
            <div class="p-2 text-sm astro-Y72RTCY6">Privacy Policy Chrome Extension</div>
          </a><a href="/post/betapa-mudahnya-mencari-uang" class="rounded-lg shadow border overflow-none astro-Y72RTCY6">
            <img src="http://artsyeditor.com/wp-content/uploads/2011/03/hello-world.png" alt="" class="w-full astro-Y72RTCY6">
            <div class="p-2 text-sm astro-Y72RTCY6">Betapa Mudahnya Mencari Uang di Zaman Sekarang</div>
          </a><a href="/post/cara-cepat-meningkatkan-viewer-youtube" class="rounded-lg shadow border overflow-none astro-Y72RTCY6">
            <img src="https://user-images.githubusercontent.com/7939342/201463147-d472ee73-df72-4405-a974-71924d50e1ff.png" alt="" class="w-full astro-Y72RTCY6">
            <div class="p-2 text-sm astro-Y72RTCY6">How to Quickly Increase YouTube Viewers</div>
          </a>
    </div>
    <div class="disqus-data" data-url="/post/how-to-send-request-git-http-protocol-v2" data-identifier="how-to-send-request-git-http-protocol-v2">
</div>
<div id="disqus_thread"></div>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
  </div>
  

</html>

